# Vercel環境クリーンアップガイド

## 概要

このドキュメントは、IPブロック問題により本番運用が不可能となったVercel環境のクリーンアップ手順を説明します。

**✅ クリーンアップ完了**: 2025年12月8日、Vercelプロジェクトは完全に削除されました。

## 背景

2025年12月7日、Vercel本番環境へのデプロイは成功しましたが、VercelのIPアドレスが宇美町システムのファイアウォールによってブロックされ、スクレイピング機能が動作しない問題が発生しました。そのため、Render.comへの移行を決定しました。

**問題の詳細**: `net::ERR_CONNECTION_TIMED_OUT`エラー

## クリーンアップ実施記録

### 実施日
2025年12月8日

### 実施内容
Vercelプロジェクト `umi-facility-reservation` を完全に削除しました。

### 削除理由
- IPブロック問題により本番運用が不可能
- Render.comへの移行が完了し、正常稼働を確認済み
- Vercel環境の維持コストの削減
- 混乱を避けるため、使用しないプラットフォームのリソースを削除

### 削除されたリソース
- Vercelプロジェクト: `umi-facility-reservation`
- すべてのデプロイメント履歴
- プロジェクト設定
- `.vercel.app` ドメイン

---

**注意**: 以下は参考情報です。実際のクリーンアップは2025年12月8日に完了しています。

---

## クリーンアップ手順（参考）

### 1. Vercelプロジェクトの設定更新

#### 1.1 プロジェクト説明の更新

1. [Vercelダッシュボード](https://vercel.com/dashboard)にアクセス
2. `umi-facility-reservation`プロジェクトを選択
3. **Settings** → **General** に移動
4. **Project Description**を以下のように更新：

```
【アーカイブ済み】宇美町施設予約検索システム - IPブロック問題によりRender.comへ移行済み。このプロジェクトは参照用として保持。
```

#### 1.2 プロジェクトステータスの変更

1. **Settings** → **General**の**Project Status**セクション
2. 必要に応じて **Pause Deployments** を有効化（自動デプロイを停止）

### 2. カスタムドメインの確認と解除

#### 2.1 カスタムドメインの確認

1. **Settings** → **Domains** に移動
2. カスタムドメインが設定されているか確認

#### 2.2 カスタムドメインの解除（設定されている場合）

1. 各カスタムドメインの右側にある **⋯** メニューをクリック
2. **Remove Domain** を選択
3. 確認ダイアログで削除を承認

**注意**: デフォルトの `.vercel.app` ドメインは削除不要です。

### 3. デプロイメントのアーカイブ（オプション）

#### 3.1 本番デプロイメントの確認

1. プロジェクトのトップページに移動
2. **Deployments** タブを選択
3. Production環境のデプロイメントを確認

#### 3.2 不要なデプロイメントの削除（オプション）

**注意**: 完全に削除する前に、デプロイ履歴を保持することをお勧めします。

1. 削除したいデプロイメントをクリック
2. 右上の **⋯** メニューから **Delete Deployment** を選択

**推奨**: 移行の記録として、少なくとも最後のProductionデプロイメントは残しておくことを推奨します。

### 4. プロジェクトの完全削除（非推奨）

**警告**: この操作は不可逆です。以下の理由により、プロジェクトの削除は推奨しません：

- デプロイ履歴の消失
- 設定情報の消失
- 将来の参照が不可能

#### 削除手順（実施する場合のみ）

1. **Settings** → **General** に移動
2. 最下部の **Delete Project** セクションまでスクロール
3. プロジェクト名を入力して削除を確認

**代替案**: プロジェクトを削除する代わりに、説明文の更新とデプロイの一時停止で十分です。

## 推奨アクション（完了）

以下のアクションを実施しました：

1. ✅ **プロジェクトの完全削除** - 2025年12月8日に実施完了

## 移行理由の記録

### IPブロック問題の詳細

- **発生日**: 2025年12月7日
- **エラー**: `net::ERR_CONNECTION_TIMED_OUT`
- **原因**: VercelのIPアドレスが宇美町システムのファイアウォールによってブロック
- **試行した対策**:
  - リトライロジックの実装
  - User-Agent変更
  - タイムアウト延長
  - すべて失敗
- **解決策**: Render.comへの移行
- **移行先URL**: https://umi-facility-reservation.onrender.com

### Render.comでの検証結果

- ✅ IPブロック問題解決
- ✅ 宇美町システムへのアクセス成功
- ✅ 7日分のスクレイピング成功
- ✅ すべての機能が正常動作

## ドキュメント更新

以下のドキュメントをRender.comへの移行に合わせて更新します：

1. **README.md** - デプロイ先をRender.comに変更
2. **docs/deployment/render-deployment-guide.md** - Render.comデプロイガイド（既存）
3. **docs/deployment/monitoring-guide.md** - モニタリングガイド（既存）

## 参照リンク

- ~~[Vercelダッシュボード](https://vercel.com/dashboard)~~ - プロジェクト削除済み
- [Render.com本番環境](https://umi-facility-reservation.onrender.com)
- [Render.comダッシュボード](https://dashboard.render.com/)

## 完了チェックリスト

- [x] Vercelプロジェクトを削除 - 2025年12月8日完了
- [x] README.mdを更新してRender.comを本番環境として明記 - 2025年12月8日完了
- [x] このクリーンアップガイドを更新 - 2025年12月8日完了

## 備考

- **Vercelプロジェクトは削除されました**（2025年12月8日）
- Render.comでの運用が安定していることを確認済み（2025年12月7-8日）
- 本番環境: https://umi-facility-reservation.onrender.com

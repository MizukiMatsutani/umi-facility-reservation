{
  "id": "snapshot_1764943535315_058h81kbm",
  "approvalId": "approval_1764942854826_n76oyf20n",
  "approvalTitle": "技術スタックドキュメント (tech.md) の承認 [修正版]",
  "version": 3,
  "timestamp": "2025-12-05T14:05:35.315Z",
  "trigger": "approved",
  "status": "pending",
  "content": "# Technology Stack\n\n## プロジェクトタイプ\nWebアプリケーション - モバイルファーストの施設予約確認システム\n\n## コア技術\n\n### 主要言語\n- **言語**: TypeScript\n- **ランタイム**: Node.js 20.x (Vercel推奨LTSバージョン)\n- **言語固有ツール**: pnpm 9.x\n\n### 主要な依存関係・ライブラリ\n\n#### フロントエンド\n- **Next.js (App Router)**: Reactベースのフルスタックフレームワーク（v15.x - 最新LTS）\n  - サーバーサイドレンダリング（SSR）\n  - API Routes機能\n  - 静的サイト生成（SSG）の活用\n- **React**: UIライブラリ（Next.jsに含まれる）\n- **TailwindCSS**: ユーティリティファーストのCSSフレームワーク\n  - モバイルファーストなレスポンシブデザイン\n  - カスタマイズ可能なデザインシステム\n\n#### バックエンド（Next.js API Routes内）\n- **Puppeteer** または **Playwright**: ヘッドレスブラウザによるスクレイピング\n  - 動的コンテンツの取得\n  - セッション管理\n- **Cheerio**: HTMLパース（必要に応じて）\n- **date-fns** または **Day.js**: 日付操作\n\n#### データストレージ（将来拡張）\n- **初期フェーズ**: データストレージなし（リアルタイムスクレイピング）\n- **将来的な拡張**:\n  - Vercel KV (Redis) またはファイルシステムキャッシュ\n  - スクレイピング負荷軽減のためのキャッシュ機構\n\n### アプリケーションアーキテクチャ\n- **アーキテクチャパターン**: サーバーサイドレンダリング + API Routes\n- **レンダリング戦略**:\n  - 検索フォーム: クライアントサイドレンダリング（CSR）\n  - 結果表示: サーバーサイドレンダリング（SSR）またはサーバーコンポーネント\n- **状態管理**:\n  - React Hooks (useState, useEffect)\n  - URL Search Params による検索条件の永続化\n\n### データストレージ\n- **初期実装**: なし（オンデマンドスクレイピング）\n- **将来的なキャッシュ**:\n  - Vercel KV (Redis) - 無料枠の範囲内\n  - Time-To-Live (TTL) ベースのキャッシュ（1時間程度）\n\n### 外部連携\n- **スクレイピング対象**: 宇美町施設予約システム (https://www.11489.jp/Umi/web/Home/WgR_ModeSelect)\n- **プロトコル**: HTTP/HTTPS\n- **認証**: 不要（公開されている情報のみ取得）\n- **Rate Limiting**:\n  - リクエスト間隔の制御（最低5秒）\n  - 同時リクエスト数の制限（1リクエストのみ）\n\n### 監視とダッシュボード技術\n本プロジェクトでは管理用ダッシュボードは不要。\nユーザー向けのシンプルな検索・結果表示UIのみ。\n\n- **UIフレームワーク**: React (Next.js)\n- **スタイリング**: TailwindCSS\n- **リアルタイム通信**: 不要（静的な検索結果表示）\n- **状態管理**: React Hooks\n\n## 開発環境\n\n### ビルド＆開発ツール\n- **ビルドシステム**: Next.js内蔵（Turbopack/Webpack）\n- **パッケージ管理**: pnpm\n- **開発ワークフロー**:\n  - `next dev` - ホットリロード付き開発サーバー\n  - `next build` - プロダクションビルド\n  - `next start` - プロダクションサーバー起動\n\n### コード品質ツール\n- **静的解析**: ESLint (Next.js推奨設定)\n- **フォーマット**: Prettier\n- **型チェック**: TypeScript Compiler (tsc)\n- **テストフレームワーク**:\n  - Vitest または Jest (ユニットテスト)\n  - Playwright (E2Eテスト - 必要に応じて)\n- **ドキュメント**: README.md、インラインコメント\n\n### バージョン管理とコラボレーション\n- **VCS**: Git\n- **ブランチ戦略**: GitHub Flow（シンプルな運用）\n  - `main` ブランチ: プロダクション環境\n  - フィーチャーブランチ: 機能開発\n- **コードレビュープロセス**: 個人プロジェクトのため不要（将来的にPRベース）\n\n## デプロイ＆配布\n\n- **ターゲットプラットフォーム**: Vercel（無料枠）\n- **配布方法**: Web URL経由でアクセス\n- **インストール要件**: モダンモバイルブラウザ（iOS Safari 14+, Android Chrome 90+）\n- **更新メカニズム**:\n  - Vercelへのpush時に自動デプロイ\n  - ダウンタイムなしのデプロイ\n\n## 技術要件と制約\n\n### パフォーマンス要件\n- **初回表示**: 2秒以内（Lighthouse Performance 90以上目標）\n- **検索結果取得**: 10秒以内\n  - スクレイピング処理含む\n  - ローディング表示で体感速度を向上\n- **モバイル最適化**: Lighthouse Mobile Score 90以上\n- **メモリ使用量**: サーバーサイド 512MB以内（Vercel無料枠制限）\n\n### 互換性要件\n- **プラットフォームサポート**:\n  - iOS Safari 14+\n  - Android Chrome 90+\n- **依存関係バージョン**:\n  - Node.js 20.x (Vercel推奨LTS)\n  - Next.js 15.x (最新LTS)\n  - pnpm 9.x\n- **標準準拠**: HTML5, CSS3, ES2020+\n\n### セキュリティとコンプライアンス\n- **セキュリティ要件**:\n  - HTTPS通信（Vercelデフォルト）\n  - XSS対策（Reactのデフォルト保護）\n  - スクレイピング先への過度な負荷防止\n  - ユーザーデータの保存なし（プライバシー配慮）\n- **コンプライアンス標準**:\n  - 公開情報のスクレイピング（利用規約確認済み前提）\n  - 個人情報保護法準拠（ユーザーデータ非保存）\n- **脅威モデル**:\n  - スクレイピング先システムへのDoS攻撃リスク → Rate Limiting実装\n  - スクレイピング先のHTML構造変更 → エラーハンドリングとフォールバック\n\n### スケーラビリティと信頼性\n- **想定負荷**:\n  - 同時ユーザー数: 1-2名程度（チームメンバー限定）\n  - リクエスト数: 1日あたり10-20リクエスト未満\n- **可用性要件**:\n  - Vercel無料枠の範囲内での最大努力\n  - 99%アップタイム目標（Vercel依存）\n- **成長予測**:\n  - 初期フェーズでは成長予測なし\n  - 将来的に他チームへの展開可能性あり\n\n## 技術的決定事項と根拠\n\n### 決定ログ\n\n1. **Next.js (App Router) の採用**\n   - **理由**:\n     - フロントエンドとバックエンドを一つのフレームワークで実装可能\n     - Vercelへのデプロイが簡単（公式サポート）\n     - サーバーサイドレンダリングによるパフォーマンス最適化\n     - API Routesでスクレイピング処理を実装可能\n   - **代替案**:\n     - Remix: 学習コストと実績を考慮してNext.jsを選択\n     - SPA + 別途バックエンド: 開発コストと運用コストが増加\n\n2. **TailwindCSSの採用**\n   - **理由**:\n     - モバイルファーストなレスポンシブデザインが簡単\n     - ユーティリティクラスによる高速な開発\n     - バンドルサイズの最適化（未使用CSSの自動削除）\n   - **代替案**:\n     - CSS Modules: スタイリングの柔軟性とモバイル最適化を優先\n     - Styled-components: ビルド時のパフォーマンスを考慮\n\n3. **Puppeteer/Playwrightによるスクレイピング**\n   - **理由**:\n     - 動的JavaScriptコンテンツの取得が可能\n     - セッション管理が容易\n     - ブラウザ操作の自動化\n   - **代替案**:\n     - Cheerio + Axios: 対象サイトが動的レンダリングの可能性があるため不採用\n   - **トレードオフ**:\n     - 実行コストが高い → Vercel Serverless Functionの制限に注意\n\n4. **初期フェーズでのキャッシュレス設計**\n   - **理由**:\n     - 実装の簡素化\n     - データベース管理コストの削減\n     - リアルタイム性の確保\n   - **トレードオフ**:\n     - スクレイピング先への負荷増加 → Rate Limitingで緩和\n     - レスポンス時間の増加 → ローディング表示で対応\n   - **将来的な改善**: Vercel KVによるキャッシュ実装\n\n5. **Vercelでのホスティング**\n   - **理由**:\n     - Next.jsとの親和性が高い\n     - 無料枠が十分（小規模チーム用途）\n     - CI/CD自動化\n     - グローバルCDN\n   - **代替案**:\n     - AWS Amplify: 設定の複雑さを考慮して不採用\n     - Netlify: Serverless Functionの制限を考慮\n\n## 既知の制限事項\n\n### 技術的制約\n1. **Vercel Serverless Functionの実行時間制限**\n   - **制限**: 無料枠では10秒、Hobby枠では10秒\n   - **影響**: 複雑なスクレイピング処理が10秒を超える可能性\n   - **対策**:\n     - スクレイピング対象を絞る（バスケットボール関連施設のみ）\n     - タイムアウト時のエラーハンドリング\n     - 将来的にはバックグラウンドジョブ化を検討\n\n2. **スクレイピング先のHTML構造変更リスク**\n   - **制限**: 宇美町システムのHTML構造変更時にスクレイピングが失敗\n   - **影響**: アプリケーション全体の機能停止\n   - **対策**:\n     - エラー検知とユーザーへの通知\n     - HTML構造のバージョン検出機能\n     - フォールバック表示\n\n3. **同時リクエスト制限**\n   - **制限**: スクレイピング先への配慮から同時リクエストは1つのみ\n   - **影響**: 複数ユーザーの同時検索時に待機時間が発生\n   - **対策**:\n     - キューイング機構の実装\n     - ユーザーへの待ち時間表示\n     - 将来的なキャッシュ機能での緩和\n\n4. **モバイルブラウザの互換性**\n   - **制限**: 古いブラウザバージョンではUIが崩れる可能性\n   - **影響**: 一部ユーザーの利用困難\n   - **対策**:\n     - モダンブラウザの使用を推奨\n     - Graceful degradation\n\n### 運用上の制約\n1. **スクレイピング先システムの利用規約**\n   - **制限**: スクレイピングが明示的に禁止される可能性\n   - **対策**: 利用規約の定期確認、必要に応じて町への問い合わせ\n\n2. **メンテナンスとモニタリング**\n   - **制限**: 個人運用のため24時間監視は困難\n   - **対策**: エラー通知機能、定期的な動作確認\n",
  "fileStats": {
    "size": 10394,
    "lines": 244,
    "lastModified": "2025-12-05T13:53:58.099Z"
  },
  "comments": []
}
{
  "id": "snapshot_1764943836252_uxkukfhrk",
  "approvalId": "approval_1764943650530_e7pm786y6",
  "approvalTitle": "プロジェクト構造ドキュメント (structure.md) の承認",
  "version": 2,
  "timestamp": "2025-12-05T14:10:36.252Z",
  "trigger": "approved",
  "status": "pending",
  "content": "# Project Structure\n\n## ディレクトリ構成\n\n```\numi-facility-reservation/\n├── src/\n│   ├── app/                      # Next.js App Router\n│   │   ├── layout.tsx           # ルートレイアウト\n│   │   ├── page.tsx             # トップページ（検索フォーム）\n│   │   ├── api/                 # API Routes\n│   │   │   └── scrape/         # スクレイピングAPI\n│   │   │       └── route.ts    # POST /api/scrape\n│   │   └── results/            # 検索結果ページ\n│   │       └── page.tsx        # 結果表示\n│   │\n│   ├── components/              # Reactコンポーネント\n│   │   ├── ui/                 # 汎用UIコンポーネント\n│   │   │   ├── Button.tsx\n│   │   │   ├── LoadingSpinner.tsx\n│   │   │   ├── DatePicker.tsx\n│   │   │   └── TimePicker.tsx\n│   │   ├── SearchForm.tsx      # 検索フォームコンポーネント\n│   │   ├── FacilityCard.tsx    # 施設カード表示\n│   │   └── AvailabilityList.tsx # 空き時間リスト\n│   │\n│   ├── lib/                     # ユーティリティとロジック\n│   │   ├── scraper/            # スクレイピング関連\n│   │   │   ├── index.ts        # スクレイパーメイン\n│   │   │   ├── parser.ts       # HTMLパーサー\n│   │   │   ├── navigator.ts    # ページナビゲーション\n│   │   │   └── rateLimiter.ts  # レート制限\n│   │   ├── utils/              # ユーティリティ関数\n│   │   │   ├── date.ts         # 日付操作\n│   │   │   └── validation.ts   # バリデーション\n│   │   └── types/              # TypeScript型定義\n│   │       ├── facility.ts     # 施設関連の型\n│   │       ├── availability.ts # 空き状況の型\n│   │       └── api.ts          # APIレスポンスの型\n│   │\n│   └── styles/                  # グローバルスタイル\n│       └── globals.css         # Tailwind + カスタムCSS\n│\n├── public/                      # 静的ファイル\n│   ├── favicon.ico\n│   └── images/\n│\n├── tests/                       # テストファイル\n│   ├── unit/                   # ユニットテスト\n│   │   ├── scraper.test.ts\n│   │   └── utils.test.ts\n│   └── e2e/                    # E2Eテスト（必要に応じて）\n│       └── search.spec.ts\n│\n├── .spec-workflow/              # Spec Workflow管理\n│   ├── steering/               # ステアリングドキュメント\n│   └── specs/                  # 仕様ドキュメント\n│\n├── .github/                     # GitHub設定\n│   └── workflows/              # GitHub Actions\n│\n├── next.config.js               # Next.js設定\n├── tailwind.config.ts           # Tailwind CSS設定\n├── tsconfig.json                # TypeScript設定\n├── package.json                 # プロジェクト依存関係\n├── pnpm-lock.yaml              # pnpmロックファイル\n├── .env.local                   # 環境変数（ローカル）\n├── .gitignore\n└── README.md\n```\n\n## 命名規則\n\n### ファイル\n- **Reactコンポーネント**: `PascalCase.tsx` (例: `SearchForm.tsx`, `FacilityCard.tsx`)\n- **APIルート**: `route.ts` (Next.js App Router標準)\n- **ユーティリティ/ライブラリ**: `camelCase.ts` (例: `rateLimiter.ts`, `date.ts`)\n- **型定義**: `camelCase.ts` (例: `facility.ts`, `availability.ts`)\n- **テスト**: `[filename].test.ts` または `[filename].spec.ts`\n\n### コード\n- **Reactコンポーネント**: `PascalCase` (例: `SearchForm`, `LoadingSpinner`)\n- **関数**: `camelCase` (例: `fetchFacilityData`, `parseAvailability`)\n- **型・インターフェース**: `PascalCase` (例: `Facility`, `AvailabilitySlot`)\n- **定数**: `UPPER_SNAKE_CASE` (例: `MAX_RETRY_COUNT`, `DEFAULT_TIMEOUT`)\n- **変数**: `camelCase` (例: `facilityList`, `selectedDate`)\n\n## インポートパターン\n\n### インポート順序\n1. React関連\n2. Next.js関連\n3. 外部ライブラリ\n4. `@/` エイリアスによる内部モジュール\n5. 相対パスによるインポート\n6. 型インポート（`import type`）\n7. スタイルインポート\n\n### インポート例\n```typescript\n// 1. React関連\nimport { useState, useEffect } from 'react';\n\n// 2. Next.js関連\nimport Link from 'next/link';\nimport { useRouter } from 'next/navigation';\n\n// 3. 外部ライブラリ\nimport { format } from 'date-fns';\nimport { ja } from 'date-fns/locale';\n\n// 4. 内部モジュール（@/エイリアス使用）\nimport { SearchForm } from '@/components/SearchForm';\nimport { fetchFacilityData } from '@/lib/scraper';\n\n// 5. 相対パス\nimport { Button } from '../ui/Button';\n\n// 6. 型インポート\nimport type { Facility, AvailabilitySlot } from '@/lib/types/facility';\n\n// 7. スタイル\nimport './styles.css';\n```\n\n### パスエイリアス設定\n- `@/`: `src/` ディレクトリのエイリアス（tsconfig.jsonで設定）\n- 絶対パスインポートを優先し、相対パスは同一ディレクトリ内のみに限定\n\n## コード構造パターン\n\n### Reactコンポーネントの構成\n\n```typescript\n// 1. インポート（上記の順序に従う）\nimport { useState } from 'react';\nimport type { Facility } from '@/lib/types/facility';\n\n// 2. 型定義（コンポーネント固有）\ninterface SearchFormProps {\n  onSubmit: (data: SearchData) => void;\n  isLoading?: boolean;\n}\n\n// 3. 定数（コンポーネント外）\nconst DEFAULT_TIME_SLOTS = ['8:30', '9:00', '9:30'];\n\n// 4. コンポーネント実装\nexport function SearchForm({ onSubmit, isLoading = false }: SearchFormProps) {\n  // 4-1. State定義\n  const [selectedDate, setSelectedDate] = useState<Date | null>(null);\n\n  // 4-2. Hooks\n  const router = useRouter();\n\n  // 4-3. イベントハンドラ\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    // ...\n  };\n\n  // 4-4. JSX return\n  return (\n    <form onSubmit={handleSubmit}>\n      {/* ... */}\n    </form>\n  );\n}\n\n// 5. ヘルパー関数（コンポーネント外）\nfunction validateTimeSlot(time: string): boolean {\n  // ...\n}\n```\n\n### API Routeの構成\n\n```typescript\n// 1. インポート\nimport { NextRequest, NextResponse } from 'next/server';\nimport { scrapeAvailability } from '@/lib/scraper';\nimport type { ScrapeRequest, ScrapeResponse } from '@/lib/types/api';\n\n// 2. 定数\nconst MAX_REQUEST_SIZE = 1024;\n\n// 3. メインハンドラ\nexport async function POST(request: NextRequest) {\n  try {\n    // 3-1. バリデーション\n    const body = await request.json();\n    validateRequest(body);\n\n    // 3-2. ビジネスロジック\n    const result = await scrapeAvailability(body);\n\n    // 3-3. レスポンス\n    return NextResponse.json<ScrapeResponse>(result);\n  } catch (error) {\n    // 3-4. エラーハンドリング\n    return handleError(error);\n  }\n}\n\n// 4. ヘルパー関数\nfunction validateRequest(body: unknown): asserts body is ScrapeRequest {\n  // ...\n}\n```\n\n### ユーティリティ関数の構成\n\n```typescript\n// 1. インポート\nimport { format, addDays } from 'date-fns';\nimport { ja } from 'date-fns/locale';\n\n// 2. 型定義\nexport interface DateRange {\n  start: Date;\n  end: Date;\n}\n\n// 3. メイン関数（エクスポート）\nexport function formatDateRange(range: DateRange): string {\n  // ...\n}\n\nexport function getNextAvailableDate(current: Date, excludeDays: number[]): Date {\n  // ...\n}\n\n// 4. ヘルパー関数（非エクスポート）\nfunction isWeekend(date: Date): boolean {\n  // ...\n}\n```\n\n## コード組織化の原則\n\n1. **単一責任の原則**\n   - 各ファイルは1つの明確な目的を持つ\n   - コンポーネントは1つの機能に集中\n   - ユーティリティ関数は1つのタスクのみ実行\n\n2. **モジュール性**\n   - 機能ごとにディレクトリを分割\n   - 再利用可能なコンポーネントは `components/ui/` に配置\n   - ビジネスロジックは `lib/` に分離\n\n3. **テスタビリティ**\n   - ビジネスロジックをReactコンポーネントから分離\n   - Pure Functionを優先\n   - 依存性注入を活用\n\n4. **一貫性**\n   - 同じパターンを全体で使用\n   - 命名規則の統一\n   - ディレクトリ構造の統一\n\n## モジュール境界\n\n### レイヤー分離\n\n```\npresentation (components/)\n    ↓ 依存\nbusiness logic (lib/)\n    ↓ 依存\nexternal services (lib/scraper/)\n```\n\n### 依存関係のルール\n\n1. **上位層は下位層に依存できる**\n   - コンポーネント → lib → 外部サービス\n\n2. **下位層は上位層に依存できない**\n   - スクレイパーはReactコンポーネントをインポートしない\n   - ユーティリティはビジネスロジックに依存しない\n\n3. **同一層内での依存は最小限に**\n   - コンポーネント間の循環依存を避ける\n   - 共通機能は下位層に移動\n\n### 境界パターン\n\n- **UI vs ロジック**: Reactコンポーネント（UI）とビジネスロジック（lib）を分離\n- **公開API vs 内部実装**: `index.ts` でエクスポートするものを制限\n- **スクレイパー vs アプリケーション**: スクレイピング処理を独立したモジュールとして隔離\n- **型定義の共有**: `lib/types/` で型を一元管理し、各層で共有\n\n## コードサイズガイドライン\n\n### ファイルサイズ\n- **コンポーネントファイル**: 200行以内を推奨、300行を上限\n- **ユーティリティファイル**: 150行以内を推奨\n- **APIルートファイル**: 100行以内を推奨\n- 上限を超える場合は、ファイル分割を検討\n\n### 関数・メソッドサイズ\n- **関数**: 30行以内を推奨、50行を上限\n- **Reactコンポーネント**: 50行以内を推奨、100行を上限\n- 複雑な処理は小さな関数に分割\n\n### 複雑度\n- **ネストレベル**: 最大3階層まで\n- **if文の連鎖**: 3つまで（それ以上は早期returnやswitch文を検討）\n- **関数の引数**: 最大4つまで（それ以上はオブジェクトにまとめる）\n\n## ドキュメンテーション標準\n\n### コメント規則\n\n1. **公開API**: JSDocコメント必須\n```typescript\n/**\n * 施設の空き状況を取得する\n * @param facilityId - 施設ID\n * @param date - 検索日付\n * @returns 空き時間のリスト\n * @throws {Error} スクレイピング失敗時\n */\nexport async function fetchAvailability(\n  facilityId: string,\n  date: Date\n): Promise<AvailabilitySlot[]> {\n  // ...\n}\n```\n\n2. **複雑なロジック**: インラインコメントで説明\n```typescript\n// レート制限: 5秒間隔でリクエストを送信\nawait rateLimiter.wait(5000);\n```\n\n3. **型定義**: 必要に応じてコメントを追加\n```typescript\nexport interface Facility {\n  id: string;\n  name: string;\n  /** 施設の種類（バスケットボール専用の場合は \"basketball\"） */\n  type: 'basketball' | 'multi-purpose';\n}\n```\n\n### READMEファイル\n\n- **プロジェクトルート**: プロジェクト全体の説明、セットアップ手順\n- **主要ディレクトリ**: `lib/scraper/README.md` などでモジュール固有のドキュメント\n\n### ドキュメント言語\n- コード内のコメント: 日本語\n- 型定義のコメント: 日本語\n- README: 日本語\n- commit message: 日本語\n\n## Next.js App Router固有の構造\n\n### App Routerのディレクトリ規則\n\n- `app/page.tsx`: ページコンポーネント\n- `app/layout.tsx`: レイアウトコンポーネント\n- `app/loading.tsx`: ローディング状態（自動生成）\n- `app/error.tsx`: エラーハンドリング\n- `app/api/*/route.ts`: APIエンドポイント\n\n### サーバーコンポーネント vs クライアントコンポーネント\n\n- **デフォルト**: サーバーコンポーネント（`'use client'` なし）\n- **クライアントコンポーネント**: ファイル先頭に `'use client'` を追加\n  - `useState`, `useEffect` などを使用する場合\n  - ブラウザAPIを使用する場合\n  - イベントハンドラを定義する場合\n\n```typescript\n// クライアントコンポーネントの例\n'use client';\n\nimport { useState } from 'react';\n\nexport function SearchForm() {\n  const [date, setDate] = useState<Date | null>(null);\n  // ...\n}\n```\n\n### メタデータの管理\n\n```typescript\n// app/layout.tsx\nimport type { Metadata } from 'next';\n\nexport const metadata: Metadata = {\n  title: '宇美町施設予約確認',\n  description: 'バスケットボール施設の空き状況を簡単に確認',\n};\n```\n\n## 環境変数の管理\n\n### ファイル配置\n- `.env.local`: ローカル開発環境用（gitignore）\n- `.env.example`: 環境変数のサンプル（コミット対象）\n\n### 命名規則\n```bash\n# 公開可能な環境変数（ブラウザからアクセス可能）\nNEXT_PUBLIC_APP_URL=https://example.com\n\n# サーバーサイドのみの環境変数\nSCRAPER_TIMEOUT=30000\nSCRAPER_USER_AGENT=Mozilla/5.0...\n```\n\n### 使用方法\n```typescript\n// サーバーサイドのみ\nconst timeout = process.env.SCRAPER_TIMEOUT;\n\n// クライアントサイドでも使用可能\nconst appUrl = process.env.NEXT_PUBLIC_APP_URL;\n```\n",
  "fileStats": {
    "size": 13602,
    "lines": 425,
    "lastModified": "2025-12-05T14:07:21.366Z"
  },
  "comments": []
}
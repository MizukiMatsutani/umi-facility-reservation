{
  "id": "snapshot_1765176886985_bwkt9bjk0",
  "approvalId": "approval_1765176886954_3xy9yba0u",
  "approvalTitle": "è¨­è¨ˆæ›¸ (Design) - æ¤œç´¢é€Ÿåº¦æœ€é©åŒ–",
  "version": 1,
  "timestamp": "2025-12-08T06:54:46.985Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Design Document\n\n## Overview\n\næ¤œç´¢é€Ÿåº¦æœ€é©åŒ–æ©Ÿèƒ½ã¯ã€å®‡ç¾ç”ºæ–½è¨­äºˆç´„æ¤œç´¢ã‚·ã‚¹ãƒ†ãƒ ã®ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°å‡¦ç†ã‚’é«˜é€ŸåŒ–ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã‚’æ”¹å–„ã—ã¾ã™ã€‚ä»¥ä¸‹ã®3ã¤ã®ä¸»è¦ãªæœ€é©åŒ–ã‚’å®Ÿè£…ã—ã¾ã™ï¼š\n\n1. **å¾…æ©Ÿæ™‚é–“ã®å‹•çš„æœ€é©åŒ–**: å›ºå®šã® `setTimeout` ã‚’æ¡ä»¶ãƒ™ãƒ¼ã‚¹ã® `waitForFunction` ã«ç½®ãæ›ãˆ\n2. **ãƒªã‚½ãƒ¼ã‚¹èª­ã¿è¾¼ã¿ã®æœ€é©åŒ–**: ä¸è¦ãªãƒªã‚½ãƒ¼ã‚¹ï¼ˆç”»åƒãƒ»CSSãƒ»ãƒ•ã‚©ãƒ³ãƒˆï¼‰ã®èª­ã¿è¾¼ã¿ã‚’ãƒ–ãƒ­ãƒƒã‚¯\n3. **ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹è¡¨ç¤º**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§å‡¦ç†çŠ¶æ³ã‚’è¡¨ç¤º\n\nã“ã‚Œã‚‰ã®æœ€é©åŒ–ã«ã‚ˆã‚Šã€7æ—¥æ¤œç´¢ã§14ã€œ28ç§’ã®é€Ÿåº¦æ”¹å–„ã¨ã€ä½“æ„Ÿé€Ÿåº¦ã®å¤§å¹…ãªæ”¹å–„ã‚’å®Ÿç¾ã—ã¾ã™ã€‚\n\n## Steering Document Alignment\n\n### Technical Standards (tech.md)\n\næœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã«æº–æ‹ :\n- **Next.js 15** (App Router) - APIãƒ«ãƒ¼ãƒˆã¨ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰å‡¦ç†\n- **TypeScript** - å‹å®‰å…¨æ€§ã‚’ç¢ºä¿\n- **Puppeteer** - ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã‚¨ãƒ³ã‚¸ãƒ³\n- **React** - UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ\n- **Tailwind CSS** - ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°\n\n### Project Structure (structure.md)\n\næ—¢å­˜ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ã«å¾“ã„ã€ä»¥ä¸‹ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«å®Ÿè£…:\n- `src/lib/scraper/` - ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°æœ€é©åŒ–ãƒ­ã‚¸ãƒƒã‚¯\n- `src/components/ui/` - ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹è¡¨ç¤ºUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ\n- `src/lib/types/` - å‹å®šç¾©ã®æ‹¡å¼µ\n- `src/app/page.tsx` - ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹è¡¨ç¤ºã®çµ±åˆ\n\n## Code Reuse Analysis\n\n### Existing Components to Leverage\n\n- **FacilityScraper (src/lib/scraper/index.ts)**:\n  - æ—¢å­˜ã®ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ‹¡å¼µ\n  - 13ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æŒã¤ãƒ¡ã‚¤ãƒ³ã‚¯ãƒ©ã‚¹\n  - æœ€é©åŒ–å¯¾è±¡: `scrapeFacilities`, `selectSports`, `selectDatesOnFacilityCalendar`\n\n- **Toast (src/components/ui/Toast.tsx)**:\n  - æ—¢å­˜ã®ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ\n  - ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼æ©Ÿèƒ½ã‚’æ—¢ã«å®Ÿè£…æ¸ˆã¿\n  - æ–°ã—ã„ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹è¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ‡ã‚¶ã‚¤ãƒ³å‚è€ƒ\n\n- **RateLimiter (src/lib/scraper/rateLimiter.ts)**:\n  - ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®é€²è¡ŒçŠ¶æ…‹ç®¡ç† (`isRequestInProgress`)\n  - ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹é€šçŸ¥ã¨ã®çµ±åˆãƒã‚¤ãƒ³ãƒˆ\n\n### Integration Points\n\n- **API Endpoint (/api/scrape)**:\n  - Server-Sent Events (SSE) ã¾ãŸã¯ãƒãƒ¼ãƒªãƒ³ã‚°ã§ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹æƒ…å ±ã‚’é€ä¿¡\n  - æ—¢å­˜ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’ç¶­æŒ\n\n- **SearchForm Component**:\n  - ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹è¡¨ç¤ºUIã‚’çµ±åˆ\n  - `isLoading` çŠ¶æ…‹ã‚’æ‹¡å¼µã—ã¦ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹æƒ…å ±ã‚’å«ã‚ã‚‹\n\n## Architecture\n\næœ¬è¨­è¨ˆã¯æ—¢å­˜ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’æ‹¡å¼µã—ã€ä»¥ä¸‹ã®åŸå‰‡ã«å¾“ã„ã¾ã™:\n\n### Modular Design Principles\n\n- **Single File Responsibility**:\n  - å¾…æ©Ÿãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£: `src/lib/scraper/waitUtils.ts`\n  - ãƒªã‚½ãƒ¼ã‚¹ãƒ–ãƒ­ãƒƒã‚¯: `src/lib/scraper/resourceOptimizer.ts`\n  - ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒˆãƒ©ãƒƒã‚«ãƒ¼: `src/lib/scraper/progressTracker.ts`\n\n- **Component Isolation**:\n  - ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹è¡¨ç¤ºUI: `src/components/ui/ProgressIndicator.tsx`\n  - æ—¢å­˜ã®ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ãƒ­ã‚¸ãƒƒã‚¯ã¸ã®å½±éŸ¿ã‚’æœ€å°åŒ–\n\n- **Service Layer Separation**:\n  - ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°å±¤ (FacilityScraper) ã¯ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹é€šçŸ¥ã®ã¿é€ä¿¡\n  - UIå±¤ (React Component) ãŒãƒ—ãƒ­ã‚°ãƒ¬ã‚¹æƒ…å ±ã‚’å—ä¿¡ãƒ»è¡¨ç¤º\n\n- **Utility Modularity**:\n  - å„æœ€é©åŒ–æ©Ÿèƒ½ã¯ç‹¬ç«‹ã—ãŸãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã¨ã—ã¦å®Ÿè£…\n  - ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§æœ‰åŠ¹åŒ–/ç„¡åŠ¹åŒ–å¯èƒ½\n\n```mermaid\ngraph TD\n    A[SearchForm Component] -->|æ¤œç´¢ãƒªã‚¯ã‚¨ã‚¹ãƒˆ| B[/api/scrape Endpoint]\n    B -->|é–‹å§‹| C[FacilityScraper]\n    C -->|ã‚¤ãƒ™ãƒ³ãƒˆé€ä¿¡| D[ProgressTracker]\n    D -->|SSE/WebSocket| E[ProgressIndicator UI]\n    E -->|è¡¨ç¤º| A\n\n    C -->|ä½¿ç”¨| F[WaitUtils]\n    C -->|ä½¿ç”¨| G[ResourceOptimizer]\n\n    F -->|å‹•çš„å¾…æ©Ÿ| H[Puppeteer Page]\n    G -->|ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ–ãƒ­ãƒƒã‚¯| H\n\n    style C fill:#e3f2fd\n    style D fill:#fff3e0\n    style E fill:#f3e5f5\n    style F fill:#e8f5e9\n    style G fill:#e8f5e9\n```\n\n## Components and Interfaces\n\n### Component 1: WaitUtils (å¾…æ©Ÿãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£)\n\n- **Purpose**: å›ºå®šæ™‚é–“å¾…æ©Ÿã‚’å‹•çš„ãªæ¡ä»¶ãƒã‚§ãƒƒã‚¯ã«ç½®ãæ›ãˆã‚‹\n- **File**: `src/lib/scraper/waitUtils.ts`\n- **Interfaces**:\n  ```typescript\n  // DOMè¦ç´ ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¾ã§å¾…æ©Ÿ\n  async function waitForVisible(\n    page: Page,\n    selector: string,\n    timeout?: number\n  ): Promise<void>\n\n  // AJAXå®Œäº†ã‚’å¾…æ©Ÿ\n  async function waitForAjaxComplete(\n    page: Page,\n    timeout?: number\n  ): Promise<void>\n\n  // ã‚«ã‚¹ã‚¿ãƒ æ¡ä»¶ã‚’å¾…æ©Ÿ\n  async function waitForCondition(\n    page: Page,\n    condition: () => boolean | Promise<boolean>,\n    timeout?: number\n  ): Promise<void>\n  ```\n- **Dependencies**: Puppeteer Page API\n- **Reuses**: æ—¢å­˜ã® `page.waitForFunction` ã‚’æ‹¡å¼µ\n\n### Component 2: ResourceOptimizer (ãƒªã‚½ãƒ¼ã‚¹æœ€é©åŒ–)\n\n- **Purpose**: ä¸è¦ãªãƒªã‚½ãƒ¼ã‚¹ã®èª­ã¿è¾¼ã¿ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ã¦é«˜é€ŸåŒ–\n- **File**: `src/lib/scraper/resourceOptimizer.ts`\n- **Interfaces**:\n  ```typescript\n  // ãƒšãƒ¼ã‚¸ã«ãƒªã‚½ãƒ¼ã‚¹ãƒ–ãƒ­ãƒƒã‚¯ã‚’é©ç”¨\n  async function enableResourceBlocking(\n    page: Page,\n    options?: ResourceBlockOptions\n  ): Promise<void>\n\n  interface ResourceBlockOptions {\n    blockImages?: boolean;    // default: true\n    blockStylesheets?: boolean;  // default: true\n    blockFonts?: boolean;     // default: true\n    allowlist?: string[];     // ãƒ–ãƒ­ãƒƒã‚¯ã—ãªã„URLãƒ‘ã‚¿ãƒ¼ãƒ³\n  }\n  ```\n- **Dependencies**: Puppeteer Page, Request Interception API\n- **Reuses**: ãªã—ï¼ˆæ–°è¦å®Ÿè£…ï¼‰\n\n### Component 3: ProgressTracker (ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒˆãƒ©ãƒƒã‚«ãƒ¼)\n\n- **Purpose**: ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã®é€²æ—ã‚’è¿½è·¡ã—ã€å¤–éƒ¨ã«é€šçŸ¥\n- **File**: `src/lib/scraper/progressTracker.ts`\n- **Interfaces**:\n  ```typescript\n  class ProgressTracker {\n    // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆã‚’é€ä¿¡\n    emit(event: ProgressEvent): void\n\n    // é€²æ—ç‡ã‚’è¨ˆç®—\n    getProgress(): number\n\n    // è³¼èª­è€…ã‚’ç™»éŒ²\n    subscribe(callback: (event: ProgressEvent) => void): () => void\n  }\n\n  interface ProgressEvent {\n    phase: 'init' | 'selecting' | 'scraping' | 'complete' | 'error';\n    message: string;\n    progress: number;  // 0-100\n    currentDate?: string;\n    totalDates?: number;\n    completedDates?: number;\n  }\n  ```\n- **Dependencies**: ãªã—ï¼ˆEventEmitterãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰\n- **Reuses**: RateLimiterã® `isRequestInProgress` ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å‚è€ƒ\n\n### Component 4: ProgressIndicator (ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹è¡¨ç¤ºUI)\n\n- **Purpose**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã®é€²æ—ã‚’è¡¨ç¤º\n- **File**: `src/components/ui/ProgressIndicator.tsx`\n- **Interfaces**:\n  ```typescript\n  interface ProgressIndicatorProps {\n    isVisible: boolean;\n    phase: ProgressEvent['phase'];\n    message: string;\n    progress: number;  // 0-100\n    currentDate?: string;\n    totalDates?: number;\n    completedDates?: number;\n  }\n  ```\n- **Dependencies**: React, Tailwind CSS, lucide-react (ã‚¢ã‚¤ã‚³ãƒ³)\n- **Reuses**: Toastã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ãƒ‡ã‚¶ã‚¤ãƒ³\n\n### Component 5: FacilityScraper (æ‹¡å¼µ)\n\n- **Purpose**: æ—¢å­˜ã®ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã‚¯ãƒ©ã‚¹ã«æœ€é©åŒ–æ©Ÿèƒ½ã‚’çµ±åˆ\n- **File**: `src/lib/scraper/index.ts` (æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿®æ­£)\n- **Interfaces**:\n  ```typescript\n  class FacilityScraper {\n    constructor(\n      progressCallback?: (event: ProgressEvent) => void,\n      options?: ScraperOptions\n    )\n\n    // æ—¢å­˜ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æœ€é©åŒ–\n    async scrapeFacilities(dates: Date[]): Promise<FacilityAvailability[]>\n  }\n\n  interface ScraperOptions {\n    enableResourceBlocking?: boolean;  // default: true\n    enableDynamicWait?: boolean;       // default: true\n    reportProgress?: boolean;          // default: true\n  }\n  ```\n- **Dependencies**: WaitUtils, ResourceOptimizer, ProgressTracker\n- **Reuses**: æ—¢å­˜ã®å…¨13ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä¿æŒãƒ»æœ€é©åŒ–\n\n## Data Models\n\n### Model 1: ProgressEvent (ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆ)\n\n```typescript\ninterface ProgressEvent {\n  phase: 'init' | 'selecting-sports' | 'selecting-facilities' | 'selecting-dates' | 'scraping-date' | 'complete' | 'error';\n  message: string;           // æ—¥æœ¬èªã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆä¾‹: \"2/7æ—¥ç›®ã‚’å–å¾—ä¸­...\"ï¼‰\n  progress: number;          // é€²æ—ç‡ 0-100\n  timestamp: number;         // ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿæ™‚åˆ»\n\n  // æ—¥ä»˜å‡¦ç†æ™‚ã®è¿½åŠ æƒ…å ±\n  currentDate?: string;      // ç¾åœ¨å‡¦ç†ä¸­ã®æ—¥ä»˜ (YYYY-MM-DD)\n  totalDates?: number;       // ç·æ—¥æ•°\n  completedDates?: number;   // å®Œäº†ã—ãŸæ—¥æ•°\n\n  // ã‚¨ãƒ©ãƒ¼æ™‚ã®æƒ…å ±\n  error?: string;            // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸\n}\n```\n\n### Model 2: ScraperPerformanceMetrics (ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨ˆæ¸¬)\n\n```typescript\ninterface ScraperPerformanceMetrics {\n  totalDuration: number;     // åˆè¨ˆæ‰€è¦æ™‚é–“ (ms)\n  steps: StepMetric[];       // å„ã‚¹ãƒ†ãƒƒãƒ—ã®è¨ˆæ¸¬çµæœ\n\n  // æœ€é©åŒ–åŠ¹æœ\n  optimization: {\n    dynamicWaitSaved: number;       // å‹•çš„å¾…æ©Ÿã§ç¯€ç´„ã—ãŸæ™‚é–“ (ms)\n    resourceBlockingSaved: number;  // ãƒªã‚½ãƒ¼ã‚¹ãƒ–ãƒ­ãƒƒã‚¯ã§ç¯€ç´„ã—ãŸæ™‚é–“ (ms)\n  };\n}\n\ninterface StepMetric {\n  name: string;              // ã‚¹ãƒ†ãƒƒãƒ—å\n  startTime: number;         // é–‹å§‹æ™‚åˆ»\n  endTime: number;           // çµ‚äº†æ™‚åˆ»\n  duration: number;          // æ‰€è¦æ™‚é–“ (ms)\n}\n```\n\n## Error Handling\n\n### Error Scenarios\n\n1. **å‹•çš„å¾…æ©Ÿã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ**\n   - **Handling**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå€¤ï¼ˆ30ç§’ï¼‰ã‚’è¨­å®šã—ã€è¶…éæ™‚ã¯ã‚¨ãƒ©ãƒ¼ã‚’ã‚¹ãƒ­ãƒ¼\n   - **User Impact**: \"ãƒ‡ãƒ¼ã‚¿å–å¾—ãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ\" ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º\n   - **Fallback**: å›ºå®šå¾…æ©Ÿã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã—ãªã„ï¼ˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã¯çœŸã®ã‚¨ãƒ©ãƒ¼ï¼‰\n\n2. **ãƒªã‚½ãƒ¼ã‚¹ãƒ–ãƒ­ãƒƒã‚¯ã«ã‚ˆã‚‹æ©Ÿèƒ½ä¸å…¨**\n   - **Handling**: ãƒ–ãƒ­ãƒƒã‚¯å¯¾è±¡ãƒªã‚½ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ—ã‚’è¨­å®šå¯èƒ½ã«ã—ã€å•é¡ŒãŒã‚ã‚Œã°ç„¡åŠ¹åŒ–\n   - **User Impact**: æ¤œç´¢é€Ÿåº¦ã¯æ”¹å–„ã•ã‚Œãªã„ãŒã€æ©Ÿèƒ½ã¯æ­£å¸¸å‹•ä½œ\n   - **Fallback**: `options.enableResourceBlocking = false` ã§ç„¡åŠ¹åŒ–\n\n3. **ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹é€šä¿¡ã®å¤±æ•—**\n   - **Handling**: ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹è¡¨ç¤ºã¯å¤±æ•—ã—ã¦ã‚‚ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°æœ¬ä½“ã¯ç¶™ç¶š\n   - **User Impact**: ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹è¡¨ç¤ºãŒæ›´æ–°ã•ã‚Œãªã„ãŒã€æ¤œç´¢çµæœã¯å–å¾—ã§ãã‚‹\n   - **Fallback**: æ—¢å­˜ã®ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯\n\n4. **äºˆæœŸã—ãªã„ãƒšãƒ¼ã‚¸æ§‹é€ ã®å¤‰æ›´**\n   - **Handling**: æ—¢å­˜ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’ç¶­æŒï¼ˆæœ€é©åŒ–ã¯å½±éŸ¿ã—ãªã„ï¼‰\n   - **User Impact**: æ—¢å­˜ã¨åŒã˜ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸\n   - **Fallback**: ãªã—ï¼ˆæ—¢å­˜ã®å‹•ä½œã‚’ç¶­æŒï¼‰\n\n## Testing Strategy\n\n### Unit Testing\n\n- **WaitUtils**:\n  - `waitForVisible`: ã‚»ãƒ¬ã‚¯ã‚¿ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚±ãƒ¼ã‚¹ã€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚±ãƒ¼ã‚¹\n  - `waitForAjaxComplete`: AJAXå®Œäº†ã‚’æ¤œçŸ¥ã™ã‚‹ã‚±ãƒ¼ã‚¹\n  - `waitForCondition`: ã‚«ã‚¹ã‚¿ãƒ æ¡ä»¶ãŒæº€ãŸã•ã‚Œã‚‹ã‚±ãƒ¼ã‚¹\n\n- **ResourceOptimizer**:\n  - `enableResourceBlocking`: ç”»åƒãƒ»CSSãƒ»ãƒ•ã‚©ãƒ³ãƒˆãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª\n  - allowlistãŒæ©Ÿèƒ½ã™ã‚‹ã“ã¨ã‚’ç¢ºèª\n\n- **ProgressTracker**:\n  - ã‚¤ãƒ™ãƒ³ãƒˆé€ä¿¡ã¨è³¼èª­ãŒæ©Ÿèƒ½ã™ã‚‹ã“ã¨ã‚’ç¢ºèª\n  - é€²æ—ç‡ã®è¨ˆç®—ãŒæ­£ã—ã„ã“ã¨ã‚’ç¢ºèª\n\n### Integration Testing\n\n- **FacilityScraperçµ±åˆãƒ†ã‚¹ãƒˆ**:\n  - æœ€é©åŒ–æ©Ÿèƒ½ã‚’æœ‰åŠ¹ã«ã—ãŸå ´åˆã€æ—¢å­˜ã®ãƒ†ã‚¹ãƒˆãŒå…¨ã¦åˆæ ¼ã™ã‚‹ã“ã¨ã‚’ç¢ºèª\n  - æ‰€è¦æ™‚é–“ãŒçŸ­ç¸®ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’è¨ˆæ¸¬ï¼ˆ7æ—¥æ¤œç´¢ã§14ã€œ28ç§’çŸ­ç¸®ï¼‰\n\n- **API Endpointçµ±åˆãƒ†ã‚¹ãƒˆ**:\n  - ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆãŒæ­£ã—ãé€ä¿¡ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª\n  - ã‚¨ãƒ©ãƒ¼æ™‚ã‚‚ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹æƒ…å ±ãŒé©åˆ‡ã«é€šçŸ¥ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª\n\n### End-to-End Testing\n\n- **æ¤œç´¢ãƒ•ãƒ­ãƒ¼å…¨ä½“ã®ãƒ†ã‚¹ãƒˆ**:\n  1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ—¥ä»˜ã‚’é¸æŠã—ã¦æ¤œç´¢ã‚’é–‹å§‹\n  2. ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹è¡¨ç¤ºãŒè¡¨ç¤ºã•ã‚Œã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§æ›´æ–°ã•ã‚Œã‚‹\n  3. å„æ—¥ä»˜ã®å‡¦ç†ãŒå®Œäº†ã™ã‚‹ãŸã³ã«é€²æ—ãŒæ›´æ–°ã•ã‚Œã‚‹\n  4. æ¤œç´¢å®Œäº†å¾Œã€çµæœç”»é¢ã«é·ç§»ã™ã‚‹\n  5. æ‰€è¦æ™‚é–“ãŒæ”¹å–„ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª\n\n- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ãƒ†ã‚¹ãƒˆ**:\n  1. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼æ™‚ã«ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹è¡¨ç¤ºã«ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹\n  2. ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚ã«é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹\n\n## Performance Targets\n\n### ç›®æ¨™å€¤\n\n- **1æ—¥æ¤œç´¢**: ç¾åœ¨ 20ã€œ30ç§’ â†’ ç›®æ¨™ 15ã€œ25ç§’ï¼ˆç´„5ç§’çŸ­ç¸®ï¼‰\n- **7æ—¥æ¤œç´¢**: ç¾åœ¨ 120ã€œ180ç§’ â†’ ç›®æ¨™ 90ã€œ150ç§’ï¼ˆç´„30ç§’çŸ­ç¸®ï¼‰\n\n### è¨ˆæ¸¬æ–¹æ³•\n\nå„ã‚¹ãƒ†ãƒƒãƒ—ã®é–‹å§‹ãƒ»çµ‚äº†æ™‚åˆ»ã‚’è¨˜éŒ²ã—ã€ä»¥ä¸‹ã®æƒ…å ±ã‚’ãƒ­ã‚°å‡ºåŠ›:\n```\nğŸš€ ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°é–‹å§‹\nğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¬ãƒãƒ¼ãƒˆ:\n  - åˆè¨ˆæ‰€è¦æ™‚é–“: 95.3ç§’\n  - ã‚¹ãƒ†ãƒƒãƒ—1 (æ¤œç´¢ãƒšãƒ¼ã‚¸ã‚¢ã‚¯ã‚»ã‚¹): 2.1ç§’\n  - ã‚¹ãƒ†ãƒƒãƒ—2 (æ–½è¨­é¸æŠ): 3.5ç§’\n  - ã‚¹ãƒ†ãƒƒãƒ—3 (æ—¥ä»˜é¸æŠ 1/7): 8.2ç§’\n  ...\n  - æœ€é©åŒ–ã«ã‚ˆã‚‹ç¯€ç´„æ™‚é–“: 28.7ç§’\n```\n\n## Implementation Notes\n\n### æ®µéšçš„ãªå®Ÿè£…ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ\n\n1. **Phase 1**: WaitUtilsã¨ResourceOptimizerã‚’å®Ÿè£…ãƒ»ãƒ†ã‚¹ãƒˆ\n2. **Phase 2**: ProgressTrackerã¨ProgressIndicatorã‚’å®Ÿè£…\n3. **Phase 3**: FacilityScraperã«çµ±åˆã—ã€E2Eãƒ†ã‚¹ãƒˆ\n4. **Phase 4**: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨ˆæ¸¬ã¨ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°\n\n### ãƒªã‚¹ã‚¯ç®¡ç†\n\n- **ãƒªã‚½ãƒ¼ã‚¹ãƒ–ãƒ­ãƒƒã‚¯ã®å‰¯ä½œç”¨**: æœ¬ç•ªæŠ•å…¥å‰ã«ååˆ†ãªãƒ†ã‚¹ãƒˆã‚’å®Ÿæ–½\n- **ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå€¤ã®èª¿æ•´**: åˆæœŸå€¤ã¯ä¿å®ˆçš„ã«è¨­å®šï¼ˆ30ç§’ï¼‰ã€é‹ç”¨ã—ãªãŒã‚‰èª¿æ•´\n- **ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹é€šä¿¡ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰**: ã‚¤ãƒ™ãƒ³ãƒˆé€ä¿¡é »åº¦ã‚’åˆ¶å¾¡ï¼ˆæœ€å¤§1ç§’ã«1å›ï¼‰\n",
  "fileStats": {
    "size": 13333,
    "lines": 372,
    "lastModified": "2025-12-08T06:54:38.845Z"
  },
  "comments": []
}